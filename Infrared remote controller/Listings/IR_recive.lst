C51 COMPILER V9.00   IR_RECIVE                                                             03/18/2017 16:18:50 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE IR_RECIVE
OBJECT MODULE PLACED IN .\Objects\IR_recive.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE module\IR_recive.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\include;.\common;.\
                    -module) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\Listings\IR_recive.lst) TABS(2) OBJECT(.\Objects\IR_recive.obj)

line level    source

   1          #include <stdio.h>
   2          #include "N76E003.h"
   3          #include "Define.h"
   4          #include "Common.h"
   5          #include "Delay.h"
   6          #include "SFR_Macro.h"
   7          #include "Function_define.h"
   8          #include "IR_recive.h"
   9          #include "Codingformat_Define.h"
  10          
  11          
  12          UINT8 dat[Data_count]={0},key_press=0,n=0;
  13          bit Recive_flag=0,long_press_flag=0;
  14          
  15          void INT1_ISR_init(void)
  16          {
  17   1          set_EX1;              
  18   1          set_IT1;      //下降沿触发      
  19   1          P17 = 1;
  20   1      }
  21          
  22          
  23          void INT1_ISR(void) interrupt 2
  24          {
  25   1          UINT8 i=0,j=0;
  26   1          clr_EX1;
  27   1          clr_GPIO1;                                //亮指示灯
  28   1          Timer1_Delay1ms(1);
  29   1          if(P17)                                   //抖动无用中断
  30   1          {
  31   2              set_EX1;
  32   2              return;
  33   2          }
  34   1          
  35   1      #if 0
                for(i=0;i<33;i++)
                {
                  while(!P17);//low
                  while(P17);//high
                }
                while(!P17);//low
                set_EX1;
              #endif
  44   1        
  45   1          BootCode_OR_RepeatCode();
  46   1          if(!long_press_flag)
  47   1          {
  48   2              one_press();
  49   2          }
  50   1          else
  51   1          {
  52   2              long_press();
  53   2          }
  54   1          
C51 COMPILER V9.00   IR_RECIVE                                                             03/18/2017 16:18:50 PAGE 2   

  55   1          set_EX1;
  56   1        
  57   1        #if 0
                  for(i=0;i<First_Boot_code-2;i++)            //9ms low
                  {
                      if(P17)
                      {
                          dat_clr();
                          set_EX1;
                          return;
                      }
                      Timer1_Delay1ms(1);
                  }
                  while(!P17);
                
                  for(i=0;i<Second_Boot_code;i++)           //4ms high
                  {
                      Timer1_Delay1ms(1);
                      if(!P17)
                      {
                          dat_clr();
                          set_EX1;
                          return;
                      }
                  }
                  while(P17);
                
                  for(i=0;i<Data_count;i++)             //32bit数据码
                  {
                      for(j=0;j<8;j++)
                      {
                          while(!P17);                  //0.56ms  low
                        
                          Timer1_Delay1ms(Data_0_1_code);
                          if(P17)                       //数据 1  high
                          {
                              dat[i] >>= 1;
                              dat[i] |= 0x80;
                              while(P17);
                          }
                          else                          //数据 0  high
                          {
                              dat[i] >>= 1;
                          }
                      }
                      
                  }
                    
                  while(!P17);                          //0.56ms  low
                  
                  for(i=0;i<Stop_code;i++)          //40ms    high
                  {
                      Timer1_Delay1ms(1);
                      if(!P17)
                      {
                        dat_clr();
                        set_EX1;
                        return;
                      }
                  }
              //    while(P17); 
                  
C51 COMPILER V9.00   IR_RECIVE                                                             03/18/2017 16:18:50 PAGE 3   

                  Data_Check();
                  Timer1_Delay1ms(2);                 //delay2ms
                  
                  for(i=0;i<First_Boot_code-2;i++)        
                  {
                      Timer1_Delay1ms(1);
                      if(P17)
                      {
                          dat_clr();
                          set_EX1;
                          return;
                      }
                  }
                  while(!P17);                          //8ms   low
              
              //    for(i=0;i<Second_Boot_code;i++)       
              //    {
              //        Timer1_Delay1ms(1);
              //        if(!P17)
              //        {
              //            dat_clr();
              //            set_EX1;
              //            return;
              //        }
              //    }
                  while(P17);                           //2ms   high
                  
                  while(!P17);                          //0.56ms  low
              //    Timer1_Delay1ms(2000);                  //delay2ms
              //    while(P17);
                  
                  dat_clr();
                  set_EX1;
                  return;
                  #endif
 152   1      }
 153          
 154          
 155          void Data_Check(void)
 156          {
 157   1          if(dat[2] == ~dat[3])
 158   1          {
 159   2              key_press = dat[2];
 160   2              dat_clr();
 161   2              Recive_flag = 1;
 162   2          }
 163   1          else
 164   1          {
 165   2              key_press = 0;
 166   2              Recive_flag = 0;
 167   2          }
 168   1      }
 169          
 170          void dat_clr(void)
 171          {
 172   1          UINT8 i;    
 173   1          for(i=0;i<Data_count;i++)
 174   1          {
 175   2              dat[i] = 0;
 176   2          }   
 177   1      }
 178          
C51 COMPILER V9.00   IR_RECIVE                                                             03/18/2017 16:18:50 PAGE 4   

 179          void one_press(void)
 180          {
 181   1          UINT8 i=0,j=0;  
 182   1        
 183   1          for(i=0;i<Data_count;i++)             //32bit数据码
 184   1          {
 185   2              for(j=0;j<8;j++)
 186   2              {
 187   3                  while(!P17);                  //0.56ms  low
 188   3                
 189   3                  Timer1_Delay1ms(Data_0_1_code);
 190   3                  if(P17)                       //数据 1  high
 191   3                  {
 192   4                      dat[i] >>= 1;
 193   4                      dat[i] |= 0x80;
 194   4                      while(P17);
 195   4                  }
 196   3                  else                          //数据 0  high
 197   3                  {
 198   4                      dat[i] >>= 1;
 199   4                  }
 200   3              }
 201   2              
 202   2          }
 203   1            
 204   1          while(!P17);                          //0.56ms  low
 205   1          
 206   1          Timer1_Delay1ms(60);
 207   1          while(!P17);
 208   1          Data_Check();
 209   1          n = 1;
 210   1          
 211   1      #if 0   
                  for(i=0;i<Stop_code;i++)              //40ms    high
                  {
                      Timer1_Delay1ms(1);
                      if(!P17)
                      {
                        dat_clr();
                        set_EX1;
                        return;
                      }
                  }
              //    while(P17); 
                  
                  Data_Check();
                  Timer1_Delay1ms(2);                 //delay2ms
                  
                  for(i=0;i<First_Boot_code-2;i++)        
                  {
                      Timer1_Delay1ms(1);
                      if(P17)
                      {
                          dat_clr();
                          set_EX1;
                          return;
                      }
                  }
                  while(!P17);                          //8ms   low
              
                  while(P17);                           //2ms   high
                  
C51 COMPILER V9.00   IR_RECIVE                                                             03/18/2017 16:18:50 PAGE 5   

                  while(!P17);                          //0.56ms  low
              #endif
 243   1        
 244   1      }
 245          
 246          void long_press(void)
 247          {
 248   1      //    UINT8 i;  
 249   1        
 250   1          while(!P17);
 251   1          Timer1_Delay1ms(80);
 252   1          n++;
 253   1      }
 254          
 255          void BootCode_OR_RepeatCode(void)
 256          {
 257   1          UINT8 i=0;
 258   1          UINT32 k=0;
 259   1          for(i=0;i<First_Boot_code-2;i++)            //9-1ms low
 260   1          {
 261   2              Timer1_Delay1ms(1);
 262   2              if(P17)
 263   2              {
 264   3                  dat_clr();
 265   3                  set_EX1;
 266   3                  return;
 267   3              }
 268   2          }
 269   1          while(!P17);
 270   1          
 271   1          do                                        //4ms_OR_2ms  high
 272   1          {
 273   2              k++;
 274   2              if((k>200&&k<400)&&(!P17))
 275   2              {
 276   3                  long_press_flag = 1;
 277   3                  break;
 278   3              }
 279   2              else
 280   2              {
 281   3                  long_press_flag = 0;
 282   3              }
 283   2          }while(P17);
 284   1          while(!P17);
 285   1          
 286   1      #if 0   
                  for(i=0;i<Second_Boot_code;i++)           //4ms_OR_2ms  high
                  {
                      Timer1_Delay1ms(1);
                      if((!P17)&&(i>15))
                      {
                          long_press_flag = 1;
                          break;
                      }
                      else
                      {
                          long_press_flag = 0;
                      }
                  }
                  while(P17); 
              #endif
 302   1      }
C51 COMPILER V9.00   IR_RECIVE                                                             03/18/2017 16:18:50 PAGE 6   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    380    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
